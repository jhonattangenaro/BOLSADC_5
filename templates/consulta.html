<!-- templates/consulta.html - VERSI√ìN RESPONSIVA -->
{% extends "base.html" %}

{% block title %}An√°lisis Hist√≥rico - {{ simbolo }}{% endblock %}

{% block content %}
<div class="mb-6 md:mb-8">
    <h2 class="text-2xl md:text-3xl font-black italic uppercase tracking-tighter">An√°lisis Hist√≥rico</h2>
    <p class="text-slate-500 dark:text-slate-400 font-bold uppercase text-xs tracking-widest">
        üìà Consulta y an√°lisis detallado por s√≠mbolo y per√≠odo
    </p>
</div>

<!-- Formulario de b√∫squeda -->
<div class="bg-white dark:bg-slate-800 p-4 md:p-6 rounded-2xl md:rounded-3xl shadow-xl border border-slate-100 dark:border-slate-700 mb-6 md:mb-8">
    <form action="/consulta" method="GET" class="grid grid-cols-1 md:grid-cols-4 gap-3 md:gap-4">
        <div class="md:col-span-2">
            <label class="block text-[10px] font-black uppercase mb-1 ml-1 text-slate-400">S√≠mbolo</label>
            <div class="relative">
                <input type="text" name="simbolo" value="{{ simbolo }}" 
                       placeholder="Ej: ARCA" 
                       id="simboloInput"
                       class="w-full p-3 rounded-xl border border-slate-200 dark:border-slate-800 dark:bg-slate-900 font-bold uppercase outline-none focus:ring-2 focus:ring-green-500 transition-all text-sm md:text-base"
                       autocomplete="off"
                       required>
                <div id="sugerenciasContainer" class="absolute z-50 w-full mt-1 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl shadow-2xl max-h-[400px] overflow-y-auto hidden">
                    <!-- Las sugerencias se cargar√°n aqu√≠ -->
                </div>
            </div>
        </div>
        
        <div>
            <label class="block text-[10px] font-black uppercase mb-1 ml-1 text-slate-400">Fecha Desde</label>
            <input type="date" name="fecha_desde" value="{{ fecha_desde }}" 
                   class="w-full p-3 rounded-xl border border-slate-200 dark:border-slate-800 dark:bg-slate-900 font-bold outline-none focus:ring-2 focus:ring-green-500 transition-all text-sm md:text-base"
                   required>
        </div>
        
        <div>
            <label class="block text-[10px] font-black uppercase mb-1 ml-1 text-slate-400">Fecha Hasta</label>
            <input type="date" name="fecha_hasta" value="{{ fecha_hasta }}" 
                   class="w-full p-3 rounded-xl border border-slate-200 dark:border-slate-800 dark:bg-slate-900 font-bold outline-none focus:ring-2 focus:ring-green-500 transition-all text-sm md:text-base"
                   required>
        </div>
        
        <div class="md:col-span-4">
            <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-black py-3 rounded-xl transition-transform active:scale-95 uppercase text-sm shadow-lg mt-2">
                üìà Consultar
            </button>
        </div>
    </form>
    
    <!-- Per√≠odos r√°pidos -->
    <div class="mt-4 md:mt-6 pt-4 md:pt-6 border-t border-slate-100 dark:border-slate-700">
        <p class="text-xs font-bold uppercase text-slate-400 mb-2 md:mb-3">Per√≠odos R√°pidos:</p>
        <div class="flex flex-wrap gap-1 md:gap-2">
            <a href="/consulta?simbolo={{ simbolo }}&fecha_desde={{ fecha_7d }}&fecha_hasta={{ fecha_hoy }}"
               class="px-3 py-1.5 md:px-4 md:py-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg md:rounded-xl text-xs font-bold transition-all active:scale-95 whitespace-nowrap">
                √öltima Semana
            </a>
            <a href="/consulta?simbolo={{ simbolo }}&fecha_desde={{ fecha_30d }}&fecha_hasta={{ fecha_hoy }}"
               class="px-3 py-1.5 md:px-4 md:py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg md:rounded-xl text-xs font-bold transition-all active:scale-95 whitespace-nowrap">
                √öltimo Mes
            </a>
            <a href="/consulta?simbolo={{ simbolo }}&fecha_desde={{ fecha_90d }}&fecha_hasta={{ fecha_hoy }}"
               class="px-3 py-1.5 md:px-4 md:py-2 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white rounded-lg md:rounded-xl text-xs font-bold transition-all active:scale-95 whitespace-nowrap">
                3 Meses
            </a>
            <a href="/consulta?simbolo={{ simbolo }}&fecha_desde={{ fecha_365d }}&fecha_hasta={{ fecha_hoy }}"
               class="px-3 py-1.5 md:px-4 md:py-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg md:rounded-xl text-xs font-bold transition-all active:scale-95 whitespace-nowrap">
                √öltimo A√±o
            </a>
        </div>
    </div>
</div>

{% if datos_historicos %}
<!-- Tarjeta principal con estad√≠sticas -->
<div class="bg-white dark:bg-slate-800 p-4 md:p-6 rounded-2xl md:rounded-3xl shadow-xl border border-slate-100 dark:border-slate-700 mb-6 md:mb-8">
    <div class="flex flex-col gap-4 md:gap-8 mb-6 md:mb-8">
        <div>
            <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4 mb-4">
                <!-- Logo de la acci√≥n -->
                <div class="relative">
                    <div class="w-12 h-12 md:w-16 md:h-16 rounded-xl md:rounded-2xl bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-800 dark:to-slate-900 flex items-center justify-center p-1 md:p-2 shadow-inner">
                        <img src="/static/img/logos/{{ simbolo }}.png" 
                             onerror="this.src='https://ui-avatars.com/api/?name={{ simbolo }}&background=16a34a&color=fff&bold=true&size=256';" 
                             class="w-10 h-10 md:w-12 md:h-12 object-contain"
                             id="accionLogo">
                    </div>
                </div>
                <div class="flex-1">
                    <!-- Mostrar s√≠mbolo y nombre de la acci√≥n -->
                    <div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3">
                        <h3 class="text-xl md:text-2xl font-black tracking-tighter uppercase">{{ simbolo }}</h3>
                        <span class="text-xs bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300 px-2 py-1 rounded-full font-bold self-start sm:self-auto">
                            {{ accion_nombre|truncate(25) }}
                        </span>
                    </div>
                    <p class="text-slate-500 dark:text-slate-400 text-xs md:text-sm mt-1">
                        {{ fecha_desde_formato }} al {{ fecha_hasta_formato }}
                        <span class="ml-2 text-xs bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded-full">
                            {{ datos_historicos|length }} registros
                        </span>
                    </p>
                </div>
            </div>
            
            <!-- Estad√≠sticas principales -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
                <div class="text-center">
                    <p class="text-[10px] font-bold text-slate-400 uppercase">Precio Inicial</p>
                    <p class="text-lg md:text-xl font-black text-slate-800 dark:text-white">Bs. {{ "{:,.2f}".format(precio_inicial) }}</p>
                </div>
                
                <div class="text-center">
                    <p class="text-[10px] font-bold text-slate-400 uppercase">Precio Final</p>
                    <p class="text-lg md:text-xl font-black text-slate-800 dark:text-white">Bs. {{ "{:,.2f}".format(precio_final) }}</p>
                </div>
                
                <div class="text-center">
                    <p class="text-[10px] font-bold text-slate-400 uppercase">Cambio (Bs)</p>
                    <p class="text-lg md:text-xl font-black {% if cambio_bs > 0 %}text-green-600 dark:text-green-400{% elif cambio_bs < 0 %}text-red-600 dark:text-red-400{% else %}text-slate-600 dark:text-slate-400{% endif %}">
                        {{ "{:+,.2f}".format(cambio_bs) }}
                    </p>
                </div>
                
                <div class="text-center">
                    <p class="text-[10px] font-bold text-slate-400 uppercase">Rendimiento %</p>
                    <p class="text-lg md:text-xl font-black {% if rendimiento_porcentaje > 0 %}text-green-600 dark:text-green-400{% elif rendimiento_porcentaje < 0 %}text-red-600 dark:text-red-400{% else %}text-slate-600 dark:text-slate-400{% endif %}">
                        {{ "{:+.2f}".format(rendimiento_porcentaje) }}%
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- GR√ÅFICO PRINCIPAL -->
    <div class="bg-white dark:bg-slate-800 rounded-xl md:rounded-2xl p-4 md:p-6 shadow-lg mb-6 md:mb-10">
        <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-2 md:gap-4 mb-4">
            <h3 class="text-lg md:text-xl font-black text-slate-800 dark:text-white">
                Evoluci√≥n de {{ simbolo }}
            </h3>
            <div class="flex items-center gap-2">
                <span class="text-xs text-slate-500 dark:text-slate-400 font-bold">
                    {{ total_dias }} puntos
                </span>
            </div>
        </div>
        
        <div class="chart-container" style="height: 300px; min-height: 250px;">
            <canvas id="graficoHistorico"></canvas>
        </div>
    </div>
    
    <!-- Estad√≠sticas adicionales en tarjetas -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mt-6 md:mt-8">
        <div class="bg-gradient-to-br from-slate-50 to-gray-100 dark:from-slate-900/20 dark:to-gray-900/30 p-4 md:p-6 rounded-xl md:rounded-2xl border border-slate-200 dark:border-slate-700">
            <h4 class="text-sm font-black uppercase text-slate-600 dark:text-slate-400 mb-3 md:mb-4 flex items-center gap-2">
                <span>üìä</span> Estad√≠sticas
            </h4>
            <div class="space-y-3 md:space-y-4">
                <div class="flex justify-between items-center">
                    <span class="text-xs md:text-sm text-slate-600 dark:text-slate-400">Precio M√°ximo</span>
                    <span class="font-bold text-base md:text-lg text-green-600 dark:text-green-400">
                        Bs. {{ "{:,.2f}".format(precio_maximo) }}
                    </span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-xs md:text-sm text-slate-600 dark:text-slate-400">Precio M√≠nimo</span>
                    <span class="font-bold text-base md:text-lg text-red-600 dark:text-red-400">
                        Bs. {{ "{:,.2f}".format(precio_minimo) }}
                    </span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-xs md:text-sm text-slate-600 dark:text-slate-400">Precio Promedio</span>
                    <span class="font-bold text-base md:text-lg text-blue-600 dark:text-blue-400">
                        Bs. {{ "{:,.2f}".format(precio_promedio) }}
                    </span>
                </div>
            </div>
        </div>
        
        <div class="bg-gradient-to-br from-green-50 to-emerald-100 dark:from-green-900/20 dark:to-emerald-900/30 p-4 md:p-6 rounded-xl md:rounded-2xl border border-green-200 dark:border-green-800/30">
            <h4 class="text-sm font-black uppercase text-green-600 dark:text-green-400 mb-3 md:mb-4 flex items-center gap-2">
                <span>üìà</span> Tendencias
            </h4>
            <div class="space-y-3 md:space-y-4">
                <div class="flex justify-between items-center">
                    <span class="text-xs md:text-sm text-green-700 dark:text-green-400">D√≠as en Alza</span>
                    <span class="font-bold text-base md:text-lg text-green-700 dark:text-green-400">
                        {{ dias_alza }}
                    </span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-xs md:text-sm text-red-700 dark:text-red-400">D√≠as en Baja</span>
                    <span class="font-bold text-base md:text-lg text-red-700 dark:text-red-400">
                        {{ dias_baja }}
                    </span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-xs md:text-sm text-blue-700 dark:text-blue-400">D√≠as Estables</span>
                    <span class="font-bold text-base md:text-lg text-blue-700 dark:text-blue-400">
                        {{ dias_estables }}
                    </span>
                </div>
            </div>
        </div>
        
        <div class="bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-blue-900/20 dark:to-indigo-900/30 p-4 md:p-6 rounded-xl md:rounded-2xl border border-blue-200 dark:border-blue-800/30">
            <h4 class="text-sm font-black uppercase text-blue-600 dark:text-blue-400 mb-3 md:mb-4 flex items-center gap-2">
                <span>üìã</span> Informaci√≥n
            </h4>
            <div class="space-y-3 md:space-y-4">
                <div class="flex justify-between items-center">
                    <span class="text-xs md:text-sm text-blue-700 dark:text-blue-400">Per√≠odo Total</span>
                    <span class="font-bold text-base md:text-lg">{{ total_dias }} d√≠as</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-xs md:text-sm text-blue-700 dark:text-blue-400">Primer Dato</span>
                    <span class="font-bold text-xs text-slate-800 dark:text-slate-200">{{ primera_fecha }}</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-xs md:text-sm text-blue-700 dark:text-blue-400">√öltimo Dato</span>
                    <span class="font-bold text-xs text-slate-800 dark:text-slate-200">{{ ultima_fecha }}</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tabla de datos hist√≥ricos - VERSI√ìN M√ìVIL -->
<div class="bg-white dark:bg-slate-800 p-4 md:p-8 rounded-2xl md:rounded-3xl shadow-xl border border-slate-100 dark:border-slate-700">
    <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-2 md:gap-4 mb-4 md:mb-6">
        <h3 class="text-lg md:text-xl font-black flex items-center gap-2">
            <span class="text-xl md:text-2xl">üìã</span> Datos Hist√≥ricos Detallados
        </h3>
        <span class="text-xs font-bold text-slate-500 dark:text-slate-400">
            P√°gina {{ pagina }} de {{ total_paginas }}
        </span>
    </div>
    
    <div class="overflow-x-auto -mx-2 md:mx-0">
        <div class="min-w-full inline-block align-middle">
            <!-- Vista m√≥vil para tabla de datos -->
            <div class="md:hidden space-y-3">
                {% for dato in datos_historicos %}
                <div class="p-3 bg-slate-50 dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-bold text-slate-700 dark:text-slate-300">{{ dato.fecha_formateada }}</span>
                        <span class="text-sm font-bold {% if dato.variacion > 0 %}text-green-600 dark:text-green-400{% elif dato.variacion < 0 %}text-red-600 dark:text-red-400{% else %}text-slate-500 dark:text-slate-400{% endif %}">
                            {% if dato.variacion > 0 %}+{% endif %}{{ "{:.2f}".format(dato.variacion) }}%
                        </span>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <p class="text-xs text-slate-500 dark:text-slate-400">Precio</p>
                            <p class="font-bold text-slate-800 dark:text-white">
                                Bs. {{ "{:,.2f}".format(dato.precio) }}
                            </p>
                        </div>
                        <div>
                            <p class="text-xs text-slate-500 dark:text-slate-400">Cantidad</p>
                            <p class="font-bold text-slate-800 dark:text-white">
                                {{ "{:,}".format(dato.cantidad) }}
                            </p>
                        </div>
                        <div class="col-span-2">
                            <p class="text-xs text-slate-500 dark:text-slate-400">Monto Total</p>
                            <p class="font-bold text-slate-800 dark:text-white">
                                Bs. {{ "{:,.2f}".format(dato.monto) }}
                            </p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Vista desktop (tabla completa) -->
            <table class="hidden md:table w-full text-left border-collapse">
                <thead>
                    <tr class="bg-slate-50 dark:bg-slate-800 text-[10px] font-black uppercase tracking-widest">
                        <th class="p-4 text-blue-600 dark:text-blue-400">Fecha</th>
                        <th class="p-4 text-right text-blue-600 dark:text-blue-400">Precio (Bs)</th>
                        <th class="p-4 text-right text-blue-600 dark:text-blue-400">Variaci√≥n %</th>
                        <th class="p-4 text-right text-blue-600 dark:text-blue-400">Cantidad</th>
                        <th class="p-4 text-right text-blue-600 dark:text-blue-400">Monto (Bs)</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-100 dark:divide-slate-800">
                    {% for dato in datos_historicos %}
                    <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors group">
                        <td class="p-4 font-bold text-slate-700 dark:text-slate-300 group-hover:text-slate-900 dark:group-hover:text-white">
                            {{ dato.fecha_formateada }}
                        </td>
                        <td class="p-4 text-right font-mono font-bold text-lg 
                            {% if dato.variacion > 0 %}
                                text-green-700 dark:text-green-400
                            {% elif dato.variacion < 0 %}
                                text-red-700 dark:text-red-400
                            {% else %}
                                text-slate-700 dark:text-slate-300
                            {% endif %}">
                            Bs. {{ "{:,.2f}".format(dato.precio) }}
                        </td>
                        <td class="p-4 text-right">
                            {% if dato.variacion > 0 %}
                            <span class="px-3 py-1.5 rounded-full font-black text-xs bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400">
                                +{{ "{:.2f}".format(dato.variacion) }}%
                            </span>
                            {% elif dato.variacion < 0 %}
                            <span class="px-3 py-1.5 rounded-full font-black text-xs bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400">
                                {{ "{:.2f}".format(dato.variacion) }}%
                            </span>
                            {% else %}
                            <span class="px-3 py-1.5 rounded-full font-black text-xs bg-slate-100 text-slate-500 dark:bg-slate-800 dark:text-slate-400">
                                {{ "{:.2f}".format(dato.variacion) }}%
                            </span>
                            {% endif %}
                        </td>
                        <td class="p-4 text-right font-bold text-slate-700 dark:text-slate-300">
                            {{ "{:,}".format(dato.cantidad) }}
                        </td>
                        <td class="p-4 text-right font-bold text-slate-700 dark:text-slate-300">
                            Bs. {{ "{:,.2f}".format(dato.monto) }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Paginaci√≥n -->
    {% if total_paginas > 1 %}
    <div class="mt-6 md:mt-8 flex justify-center">
        <div class="flex items-center gap-2">
            {% if pagina > 1 %}
            <a href="/consulta?simbolo={{ simbolo }}&fecha_desde={{ fecha_desde }}&fecha_hasta={{ fecha_hasta }}&pagina={{ pagina-1 }}"
               class="px-3 md:px-4 py-2 bg-slate-100 dark:bg-slate-800 rounded-lg font-bold text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors text-sm">
                ‚Üê Anterior
            </a>
            {% endif %}
            
            <span class="px-3 md:px-4 py-2 bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg font-bold text-sm">
                P√°gina {{ pagina }} de {{ total_paginas }}
            </span>
            
            {% if pagina < total_paginas %}
            <a href="/consulta?simbolo={{ simbolo }}&fecha_desde={{ fecha_desde }}&fecha_hasta={{ fecha_hasta }}&pagina={{ pagina+1 }}"
               class="px-3 md:px-4 py-2 bg-slate-100 dark:bg-slate-800 rounded-lg font-bold text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors text-sm">
                Siguiente ‚Üí
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>

<!-- Script actualizado para responsividad del gr√°fico -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Datos para el gr√°fico
    const labels = {{ labels|tojson|safe if labels else '[]' }};
    const precios = {{ valores|tojson|safe if valores else '[]' }};
    
    if (!labels || labels.length === 0 || !precios || precios.length === 0) {
        const chartContainer = document.querySelector('.chart-container');
        if (chartContainer) {
            chartContainer.innerHTML = `
                <div class="text-center py-12">
                    <div class="text-4xl mb-2">üìä</div>
                    <h4 class="text-lg font-black mb-2">No hay datos disponibles</h4>
                    <p class="text-slate-500 dark:text-slate-400">Selecciona otro rango de fechas.</p>
                </div>
            `;
        }
        return;
    }
    
    const ctx = document.getElementById('graficoHistorico').getContext('2d');
    
    // Determinar color de l√≠nea
    const rendimiento = {{ rendimiento_porcentaje|tojson|safe }};
    let colorLinea = 'rgb(59, 130, 246)';
    
    if (rendimiento > 0) {
        colorLinea = 'rgb(34, 197, 94)';
    } else if (rendimiento < 0) {
        colorLinea = 'rgb(239, 68, 68)';
    }
    
    // Crear degradado
    const gradient = ctx.createLinearGradient(0, 0, 0, 300);
    gradient.addColorStop(0, colorLinea.replace('rgb', 'rgba').replace(')', ', 0.2)'));
    gradient.addColorStop(1, colorLinea.replace('rgb', 'rgba').replace(')', ', 0)'));
    
    // Configurar gr√°fico responsivo
    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Precio de Cierre (Bs)',
                data: precios,
                borderColor: colorLinea,
                backgroundColor: gradient,
                borderWidth: window.innerWidth < 768 ? 2 : 3,
                pointRadius: window.innerWidth < 768 ? 2 : 4,
                pointHoverRadius: window.innerWidth < 768 ? 6 : 8,
                pointBackgroundColor: colorLinea,
                pointBorderColor: '#ffffff',
                pointBorderWidth: window.innerWidth < 768 ? 1 : 2,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: window.innerWidth >= 768,
                    position: 'top',
                    labels: {
                        font: {
                            size: window.innerWidth < 768 ? 11 : 12
                        },
                        padding: 15,
                        usePointStyle: true,
                    }
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    backgroundColor: 'rgba(15, 23, 42, 0.95)',
                    titleFont: {
                        size: window.innerWidth < 768 ? 11 : 12
                    },
                    bodyFont: {
                        size: window.innerWidth < 768 ? 11 : 12
                    },
                    padding: 10,
                    cornerRadius: 6,
                    borderColor: '#475569',
                    borderWidth: 1
                }
            },
            scales: {
                x: {
                    grid: {
                        display: true,
                        color: 'rgba(0, 0, 0, 0.05)'
                    },
                    ticks: {
                        maxRotation: window.innerWidth < 768 ? 90 : 45,
                        minRotation: window.innerWidth < 768 ? 90 : 45,
                        font: {
                            size: window.innerWidth < 768 ? 9 : 11
                        },
                        color: '#64748b'
                    }
                },
                y: {
                    beginAtZero: false,
                    grid: {
                        display: true,
                        color: 'rgba(0, 0, 0, 0.05)'
                    },
                    ticks: {
                        callback: function(value) {
                            if (value >= 1000) {
                                return `Bs ${(value/1000).toFixed(0)}k`;
                            }
                            return `Bs ${value.toLocaleString('es-VE', {maximumFractionDigits: 0})}`;
                        },
                        font: {
                            size: window.innerWidth < 768 ? 9 : 11
                        },
                        color: '#64748b'
                    }
                }
            },
            interaction: {
                intersect: false,
                mode: 'index'
            }
        }
    });
    
    // Redimensionar gr√°fico al cambiar tama√±o de ventana
    window.addEventListener('resize', function() {
        chart.options.plugins.legend.display = window.innerWidth >= 768;
        chart.options.scales.x.ticks.maxRotation = window.innerWidth < 768 ? 90 : 45;
        chart.options.scales.x.ticks.minRotation = window.innerWidth < 768 ? 90 : 45;
        chart.options.scales.x.ticks.font.size = window.innerWidth < 768 ? 9 : 11;
        chart.options.scales.y.ticks.font.size = window.innerWidth < 768 ? 9 : 11;
        chart.options.plugins.tooltip.titleFont.size = window.innerWidth < 768 ? 11 : 12;
        chart.options.plugins.tooltip.bodyFont.size = window.innerWidth < 768 ? 11 : 12;
        chart.update();
    });
});
</script>

{% else %}
<!-- Mensaje cuando no hay datos -->
<div class="text-center py-12 md:py-20 bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-800/50 dark:to-slate-900/30 rounded-xl md:rounded-3xl border-2 border-dashed border-slate-300 dark:border-slate-700 px-4">
    <div class="text-5xl md:text-6xl mb-4 animate-bounce">üìà</div>
    <h3 class="text-lg md:text-xl font-black">Sin datos hist√≥ricos para mostrar</h3>
    <p class="text-slate-500 dark:text-slate-400 text-sm max-w-md mx-auto mt-2">
        {% if simbolo %}
        No se encontraron registros para {{ simbolo }} en el per√≠odo seleccionado.
        {% else %}
        Ingresa un s√≠mbolo y selecciona un rango de fechas para consultar el hist√≥rico.
        {% endif %}
    </p>
    
    <div class="mt-6 grid grid-cols-2 md:grid-cols-3 gap-3 max-w-lg mx-auto">
        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/10 p-3 rounded-xl border border-blue-200 dark:border-blue-800/30">
            <span class="text-xl">üîç</span>
            <p class="text-xs font-bold mt-1">Busca por S√≠mbolo</p>
        </div>
        <div class="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/10 p-3 rounded-xl border border-green-200 dark:border-green-800/30">
            <span class="text-xl">üìÖ</span>
            <p class="text-xs font-bold mt-1">Selecciona Fechas</p>
        </div>
        <div class="col-span-2 md:col-span-1 bg-gradient-to-br from-purple-50 to-violet-50 dark:from-purple-900/20 dark:to-violet-900/10 p-3 rounded-xl border border-purple-200 dark:border-purple-800/30">
            <span class="text-xl">üìä</span>
            <p class="text-xs font-bold mt-1">Visualiza Gr√°ficos</p>
        </div>
    </div>
</div>
{% endif %}

<!-- CSS adicional para responsividad -->
<style>
/* Mejoras para m√≥vil */
@media (max-width: 768px) {
    .chart-container {
        margin: 0 -0.5rem;
        padding: 0 0.5rem;
    }
    
    /* Mejorar toques */
    button, a, [role="button"] {
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
    }
    
    /* Optimizar fuentes para m√≥vil */
    body {
        font-size: 14px;
        line-height: 1.5;
    }
    
    /* Ajustar contenedores */
    .max-w-6xl {
        padding-left: 0.75rem;
        padding-right: 0.75rem;
    }
}

/* Mejoras para tablets */
@media (min-width: 769px) and (max-width: 1024px) {
    .max-w-6xl {
        max-width: 90%;
    }
}

/* Asegurar que las tablas sean desplazables en m√≥vil */
.overflow-x-auto {
    -webkit-overflow-scrolling: touch;
}

/* Optimizar im√°genes */
img {
    max-width: 100%;
    height: auto;
}

/* Ajustar alturas m√≠nimas para elementos interactivos */
button, .btn, a[role="button"] {
    min-height: 44px;
    min-width: 44px;
}
</style>

{% endblock %}
